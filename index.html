<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Retro Snake</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* * General body styling to center the phone. */
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            background-color: #383838;
            font-family: 'VT323', monospace;
            overflow: hidden;
        }

        /* * Main container for the phone body.
         * Styled to look like a classic "unbreakable" phone.
         * Transform-origin is set to center for smooth scaling.
        */
        .phone-body {
            position: relative; /* For positioning the game over screen */
            width: 380px;
            height: 720px;
            background: #34495e; /* Classic phone blue-grey */
            border-radius: 35px 35px 30px 30px;
            border: 4px solid #1a252f;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 2px 3px rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            transform-origin: center center;
            transition: transform 0.2s ease-out; /* Smooth transition on resize */
        }

        .phone-top {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
        }

        .brand-logo {
            color: #c1d4e6;
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .speaker-slit {
            width: 50px;
            height: 5px;
            background-color: #2c3e50;
            border-radius: 3px;
            margin-top: 5px;
        }

        /* * The screen area of the phone. */
        .phone-screen {
            position: relative; /* For positioning pause/mute text */
            width: 100%;
            background: linear-gradient(to bottom, #9aaf89, #839b78);
            border-radius: 10px;
            border: 4px solid #111;
            padding: 10px;
            box-sizing: border-box;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            color: #303b29;
        }

        h1 {
            font-size: 2.2rem;
            margin: 0 0 5px 0;
            text-align: center;
            text-shadow: 1px 1px 0px #c1d0b9;
        }

        .score-display {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-weight: bold;
        }

        #gameCanvas {
            background-color: #839b78;
            border: 2px solid #303b29;
            border-radius: 5px;
            display: block;
        }
        
        .phone-keypad {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
            justify-content: center;
        }

        #gameOverScreen {
            position: absolute;
            top: 130px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            background-color: rgba(48, 59, 41, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #303b29;
            text-align: center;
            z-index: 10;
            color: #dce8d6;
        }

        #gameOverScreen h2 {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 2px 2px 2px #303b29;
        }
        
        #gameOverScreen p {
            font-size: 1.2rem;
            margin: 10px 0 15px 0;
        }

        #restartButton {
            background-color: #707070;
            color: #fff;
            border: 2px solid #555;
            padding: 10px 20px;
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            width: 80%;
        }
        
        .controls {
            margin-top: 10px;
            display: grid;
            grid-template-areas:
                ". up ."
                "left center right"
                ". down .";
            grid-template-rows: 1fr 1fr 1fr;
            grid-template-columns: 1fr 1fr 1fr;
            background-color: #2c3e50;
            border-radius: 25px;
            padding: 10px;
            width: 150px;
            height: 150px;
            box-shadow: inset 0 0 8px #111, 0 1px 1px #4d647c;
            border: 2px solid #1a252f;
        }

        .controls button {
            background: linear-gradient(to bottom, #4d647c, #3a4c5e);
            color: #c1d4e6;
            border: 1px solid #2c3e50;
            font-size: 1.5rem;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 1px 0 #555;
            transition: all 0.1s ease;
        }
        
        .controls button:active {
            background: linear-gradient(to top, #4d647c, #3a4c5e);
            box-shadow: inset 0 1px 4px #1a252f;
            transform: translateY(1px);
        }

        #up { grid-area: up; border-radius: 8px 8px 0 0; }
        #left { grid-area: left; border-radius: 8px 0 0 8px; }
        #down { grid-area: down; border-radius: 0 0 8px 8px; }
        #right { grid-area: right; border-radius: 0 8px 8px 0; }
        
        .controls::after {
            content: '';
            grid-area: center;
            background: #23313e;
            border-radius: 50%;
            border: 2px solid #1a252f;
            box-shadow: inset 0 0 5px #111;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="phone-body">
        <div class="phone-top">
            <div class="brand-logo">CLASSIC</div>
            <div class="speaker-slit"></div>
        </div>
        <div class="phone-screen">
            <h1>Retro Snake</h1>
            <div class="score-display">
                <span id="score">Score: 0</span>
                <span id="highScore">High Score: 0</span>
            </div>
            <canvas id="gameCanvas" width="300" height="300"></canvas>
        </div>
        <div class="phone-keypad">
            <div class="controls">
                <button id="up">▲</button>
                <button id="left">◄</button>
                <button id="down">▼</button>
                <button id="right">►</button>
            </div>
        </div>
        <div id="gameOverScreen" class="hidden">
            <h2>Game Over</h2>
            <p id="finalScore"></p>
            <button id="restartButton">Restart Game</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const phoneBody = document.querySelector('.phone-body');
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const highScoreElement = document.getElementById('highScore');
            const gameOverScreen = document.getElementById('gameOverScreen');
            const restartButton = document.getElementById('restartButton');
            const finalScoreElement = document.getElementById('finalScore');

            // --- Game Constants ---
            const TILE_SIZE = 20;
            const TILE_COUNT = canvas.width / TILE_SIZE;

            // --- Game State Variables ---
            let snake, food, direction, score, highScore, gameInterval, isGameOver;

            // --- Sound & Haptics ---
            const eatSound = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.1 } }).toDestination();
            const gameOverSound = new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack: 0.01, decay: 0.5, sustain: 0.1, release: 0.2 } }).toDestination();
            
            function triggerHapticFeedback() {
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }

            // --- Game Initialization ---
            function init() {
                snake = [{ x: 7, y: 7 }];
                generateFood();
                direction = { x: 0, y: 0 };
                score = 0;
                isGameOver = false;
                highScore = localStorage.getItem('snakeHighScore') || 0;
                
                // Update UI
                scoreElement.textContent = `Score: ${score}`;
                highScoreElement.textContent = `High Score: ${highScore}`;
                gameOverScreen.classList.add('hidden');

                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, 120);
            }
            
            // --- Main Game Loop ---
            function gameLoop() {
                if (isGameOver) return;
                update();
                draw();
            }

            // --- Update Game State ---
            function update() {
                let head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

                // Wall handling
                if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) return endGame();
                
                // Self collision
                for (let i = 1; i < snake.length; i++) {
                    if (head.x === snake[i].x && head.y === snake[i].y) return endGame();
                }

                snake.unshift(head);

                if (head.x === food.x && head.y === food.y) {
                    score++;
                    scoreElement.textContent = `Score: ${score}`;
                    eatSound.triggerAttackRelease('C5', '8n');
                    generateFood();
                } else {
                    snake.pop();
                }
            }

            // --- Draw Game Elements ---
            function draw() {
                ctx.fillStyle = '#839b78';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = '#738a6a';
                for (let i = 0; i < TILE_COUNT; i++) {
                    ctx.beginPath();
                    ctx.moveTo(i * TILE_SIZE, 0); ctx.lineTo(i * TILE_SIZE, canvas.height);
                    ctx.moveTo(0, i * TILE_SIZE); ctx.lineTo(canvas.width, i * TILE_SIZE);
                    ctx.stroke();
                }

                ctx.fillStyle = '#303b29';
                snake.forEach(segment => ctx.fillRect(segment.x * TILE_SIZE, segment.y * TILE_SIZE, TILE_SIZE - 2, TILE_SIZE - 2));
                
                ctx.fillStyle = '#c0392b';
                ctx.fillRect(food.x * TILE_SIZE, food.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            }

            function generateFood() {
                while (true) {
                    food = { x: Math.floor(Math.random() * TILE_COUNT), y: Math.floor(Math.random() * TILE_COUNT) };
                    if (!snake.some(s => s.x === food.x && s.y === food.y)) break;
                }
            }

            function endGame() {
                isGameOver = true;
                clearInterval(gameInterval);
                gameOverSound.triggerAttackRelease('C3', '2n');
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                    highScoreElement.textContent = `High Score: ${highScore}`;
                }
                finalScoreElement.textContent = `Your Score: ${score}`;
                gameOverScreen.classList.remove('hidden');
            }
            
            // --- Mobile Responsiveness ---
            function resizePhone() {
                const phoneWidth = 380;
                const phoneHeight = 720;
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;

                const scaleX = screenWidth / phoneWidth;
                const scaleY = screenHeight / phoneHeight;

                const scale = Math.min(scaleX, scaleY, 1); // Cap scale at 1

                phoneBody.style.transform = `scale(${scale})`;
            }

            // --- Control Handling ---
            function handleKeyPress(e) {
                const key = e.key;
                if (!isGameOver && direction.x === 0 && direction.y === 0) Tone.start();
                if ((key === 'ArrowUp' || key === 'w') && direction.y === 0) direction = { x: 0, y: -1 };
                else if ((key === 'ArrowDown' || key === 's') && direction.y === 0) direction = { x: 0, y: 1 };
                else if ((key === 'ArrowLeft' || key === 'a') && direction.x === 0) direction = { x: -1, y: 0 };
                else if ((key === 'ArrowRight' || key === 'd') && direction.x === 0) direction = { x: 1, y: 0 };
            }
            
            // --- Event Listeners ---
            window.addEventListener('resize', resizePhone);
            document.addEventListener('keydown', handleKeyPress);
            restartButton.addEventListener('click', () => {
                triggerHapticFeedback();
                init();
            });

            const controls = { 'up': { x: 0, y: -1 }, 'down': { x: 0, y: 1 }, 'left': { x: -1, y: 0 }, 'right': { x: 1, y: 0 } };
            for (const [id, dir] of Object.entries(controls)) {
                document.getElementById(id).addEventListener('click', () => {
                    triggerHapticFeedback();
                    if (!isGameOver && direction.x === 0 && direction.y === 0) Tone.start();
                    if (Math.abs(dir.x) !== Math.abs(direction.x) || Math.abs(dir.y) !== Math.abs(direction.y)) {
                        direction = dir;
                    }
                });
            }
            
            // Initial setup
            init();
            resizePhone(); // Call on initial load
        });
    </script>
</body>
</html>
